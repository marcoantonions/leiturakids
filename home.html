<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <link rel="icon" type="image/png" href="img/ancora.png">
    <link rel="stylesheet" type="text/css" href="style_home.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="script_home.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <title>Leitura Kids</title>
</head>

<body>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const SUPABASE_URL = 'https://dnphjoqmkvnjueiwjayu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRucGhqb3Fta3ZuanVlaXdqYXl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NjE3ODEsImV4cCI6MjA3MzUzNzc4MX0.r8-M9EZg73sIrwESfd61hyGITsEwv_TJFZOBYeXk3d8';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ===============================
        // CARREGA NOME DO USU√ÅRIO
        // ===============================
        async function carregarNomeUsuario() {
            const usuarioId = localStorage.getItem('usuarioId');
            if (!usuarioId) return;

            const { data, error } = await supabase
                .from('usuarios')
                .select('nome')
                .eq('id', usuarioId)
                .single();

            if (error) {
                console.error('Erro ao buscar usu√°rio:', error.message);
            } else if (data) {
                document.querySelector('.profile-name').textContent = data.nome;
            }
        }

        // ===============================
        // CRIA PROGRESSO INICIAL (se n√£o existir)
        // ===============================
        async function inicializarProgresso() {
            console.log("Fun√ß√£o inicializarProgresso chamada!");
            const usuarioId = localStorage.getItem('usuarioId');
            console.log("Usu√°rio ID:", usuarioId);
            if (!usuarioId) return;

            // Verifica se j√° existe um progresso
            const { data: progressoExistente, error: selectError } = await supabase
                .from('progresso')
                .select('id')
                .eq('user_id', usuarioId)
                .maybeSingle();

            if (selectError) {
                console.error('Erro ao verificar progresso:', selectError.message);
                return;
            }

            // Se n√£o existir, cria o progresso inicial
            if (!progressoExistente) {
                const { data: insertData, error: insertError } = await supabase
                    .from('progresso')
                    .insert([
                        {
                            user_id: usuarioId,
                            aulas_vistas: 0,
                            pontos: 0,
                            atividades_concluidas: 0,
                            numero_conquistas: 0,
                            nivel_usuario: 1
                        }
                    ])
                    .select(); // <-- retorna os dados criados (importante para debug)

                if (insertError) {
                    console.error('Erro ao criar progresso:', insertError);
                } else {
                    console.log('Progresso inicial criado com sucesso:', insertData);
                }
            } else {
                console.log('Progresso j√° existente.');
            }

            // Depois de criar/verificar, carrega os dados
            carregarProgresso();
        }

        // ===============================
        // MOSTRA OS DADOS NA TELA
        // ===============================
        async function carregarProgresso() {
            const usuarioId = localStorage.getItem('usuarioId');
            if (!usuarioId) return;

            const { data, error } = await supabase
                .from('progresso')
                .select('*')
                .eq('user_id', usuarioId)
                .single();

            if (error) {
                console.error('Erro ao carregar progresso:', error.message);
                return;
            }

            // Atualiza os elementos do HTML
            document.getElementById('aulas_vistas').textContent = data.aulas_vistas;
            document.getElementById('pontos').textContent = data.pontos;
            document.getElementById('atividades_concluidas').textContent = data.atividades_concluidas;
            document.getElementById('numero_conquistas').textContent = data.numero_conquistas;
            document.getElementById('nivel_usuario').textContent = `N√≠vel ${data.nivel_usuario} - Leitor Iniciante`;
        }

        // ===============================
        // EXECUTA AO CARREGAR A P√ÅGINA
        // ===============================
        carregarNomeUsuario();
        inicializarProgresso();
    </script>


    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification">
        Bem-vindo ao Leitura Kids! 
    </div>

    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <a href="home.html" class="logo">LeituraKids</a>
            <nav>

                <div class="dropdown">
                    <button onclick="toggleMenu()" class="btn btn-gray">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <div id="menuDropdown" class="dropdown-content">
                        <a href="index.html#contact">Ajuda</a>
                        <a href="index.html">Sair</a>
                    </div>
                </div>
            </nav>
        </div>
        </div>
    </header>

    <!-- Menu Vertical -->
    <nav class="side-nav">
        <div class="side-nav-item active" onclick="window.location.href='home.html'" title="Perfil">
            <img src="img/casa.png" alt="Perfil">
        </div>
        <div class="side-nav-item" onclick="window.location.href='aulas.html'" title="Aulas">
            <img src="img/livro.png" alt="Aulas">
        </div>
        <div class="side-nav-item" onclick="window.location.href='atividades.html'" title="Atividades">
            <img src="img/lapis.png" alt="Atividades">
        </div>
        <div class="side-nav-item" onclick="window.location.href='mapa.html'" title="Mapa">
            <img src="img/mapa.png" alt="Mapa">
        </div>
        <div class="side-nav-item" onclick="window.location.href='jogos.html'" title="Jogos">
            <img src="img/controle.png" alt="Jogos">
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <main class="main-content">
        <div class="profile-container">
            <!-- Cabe√ßalho do Perfil -->
            <div class="profile-header">
                <div class="profile-avatar">üßí</div>
                <h1 class="profile-name">Nome</h1>
                <div class="profile-level" id="nivel_usuario">N√≠vel 1 - Leitor Iniciante</div>
            </div>

            <!-- Estat√≠sticas -->
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/livro.png" alt="Livros" /></div>
                    <div class="stat-number" id="aulas_vistas">3</div>
                    <div class="stat-label">Aulas Vistas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/estrela.png" alt="Pontos" /></div>
                    <div class="stat-number" id="pontos">340</div>
                    <div class="stat-label">Pontos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/fogo.png" alt="Sequ√™ncia" /></div>
                    <div class="stat-number" id="atividades_concluidas">7</div>
                    <div class="stat-label">Atividades Conclu√≠das</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/trofeu.png" alt="Conquistas" /></div>
                    <div class="stat-number" id="numero_conquistas">5</div>
                    <div class="stat-label">Conquistas</div>
                </div>
            </div>

            <!-- Progresso -->
            <div class="progress-section">
                <h2 class="progress-title">Seu Progresso</h2>

                <div class="progress-item">
                    <div class="progress-label">
                        <span>Alfabeto</span>
                        <span>85%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" data-progress="85"></div>
                    </div>
                </div>

                <div class="progress-item">
                    <div class="progress-label">
                        <span>Forma√ß√£o de Palavras</span>
                        <span>70%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" data-progress="70"></div>
                    </div>
                </div>

                <div class="progress-item">
                    <div class="progress-label">
                        <span>Leitura</span>
                        <span>60%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" data-progress="60"></div>
                    </div>
                </div>

                <div class="progress-item">
                    <div class="progress-label">
                        <span>Escrita</span>
                        <span>45%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" data-progress="45"></div>
                    </div>
                </div>
            </div>

            <!-- Atividades Recentes -->
            <div class="recent-activity">
                <h2 class="activity-title">Atividades Recentes</h2>

                <div class="activity-item">
                    <div class="activity-icon icon"><img src="img/livro-leitura.png" alt="Leitura" /></div>
                    <div class="activity-text">
                        <div>Leu a hist√≥ria "Os Tr√™s Porquinhos"</div>
                        <div class="activity-date">Hoje, 14:30</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon icon"><img src="img/quebracabeca.png" alt="Quebra-Cabe√ßa" /></div>
                    <div class="activity-text">
                        <div>Completou o Jogo da Mem√≥ria - N√≠vel 2</div>
                        <div class="activity-date">Hoje, 13:15</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon icon"><img src="img/lapismao.png" alt="Escrita" /></div>
                    <div class="activity-text">
                        <div>Praticou escrita das letras M, N, O</div>
                        <div class="activity-date">Ontem, 16:20</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon icon"><img src="img/abc.png" alt="Alfabeto" /></div>
                    <div class="activity-text">
                        <div>Aprendeu 5 novas letras do alfabeto</div>
                        <div class="activity-date">Ontem, 15:45</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Conte√∫do Conquistas -->
        <main class="main-content">
            <!-- Cabe√ßalho das Conquistas -->
            <div class="conquistas-header">
                <h1>üèÜ Suas Conquistas üèÜ</h1>
                <p>Continue aprendendo e colete todas as medalhas especiais!</p>
            </div>

            <!-- Estat√≠sticas das Conquistas -->
            <div class="conquistas-stats">
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/medalha.png" alt="Conquistas" /></div>
                    <div class="stat-number">8</div>
                    <div class="stat-label">Conquistadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/cadeado.png" alt="Bloqueado" /></div>
                    <div class="stat-number">15</div>
                    <div class="stat-label">Bloqueadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/estrela.png" alt="Estrela" /></div>
                    <div class="stat-number">34.8%</div>
                    <div class="stat-label">Completado</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon"><img src="img/alvo.png" alt="Alvo" /></div>
                    <div class="stat-number">3</div>
                    <div class="stat-label">Pr√≥ximas</div>
                </div>
            </div>

            <!-- Categorias de Conquistas -->
            <div class="badges-categories">
                <!-- Alfabeto -->
                <div class="category-section">
                    <h2 class="category-title">
                        üî§ Conquistas Recentes
                    </h2>
                    <p class="category-description">Medalhas por aprender as letras e seus sons</p>
                    <div class="badges-grid">
                        <div class="badge new"
                            onclick="showBadgeDetail('Colecionador', 'üìö', 'Voc√™ j√° conhece muitas palavras!', 'Conquistado hoje!')">
                            <div class="badge-icon icon"><img src="img/livro.png" alt="Palavras" /></div>
                            <div class="badge-name">Colecionador</div>
                            <div class="badge-description">Aprenda 50 palavras</div>
                        </div>
                        <div class="badge"
                            onclick="showBadgeDetail('Primeira Letra', 'üî§', 'Parab√©ns! Voc√™ aprendeu sua primeira letra!', 'Conquistado em 15/08/2024')">
                            <div class="badge-icon icon"><img src="img/abc.png" alt="Alfabeto" /></div>
                            <div class="badge-name">Primeira Letra</div>
                            <div class="badge-description">Aprenda sua primeira letra</div>
                        </div>
                        <div class="badges-grid">
                            <div class="badge"
                                onclick="showBadgeDetail('Semana Completa', 'üî•', 'Voc√™ √© muito dedicado! Parab√©ns!', 'Conquistado em 26/08/2024')">
                                <div class="badge-icon icon"><img src="img/fogo.png" alt="Sequ√™ncia" /></div>
                                <div class="badge-name">Semana Completa</div>
                                <div class="badge-description">7 dias seguidos praticando</div>
                            </div>
                        </div>
                        <div class="badge"
                            onclick="showBadgeDetail('Quebra-Cabe√ßa', 'üß©', 'Voc√™ √© expert em quebra-cabe√ßas!', 'Conquistado em 24/08/2024')">
                            <div class="badge-icon icon"><img src="img/quebracabeca.png" alt="Quebra-Cabe√ßa" /></div>
                            <div class="badge-name">Quebra-Cabe√ßa</div>
                            <div class="badge-description">Complete 5 quebra-cabe√ßas</div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button class="back-button" onclick="location.href='conquistas.html'">Ver Todas</button>
                    </div>
                </div>
            </div>
        </main>
        <a href="#" class="ancora">
            <span class="material-symbols-outlined">anchor</span>
        </a>
</body>

</html>
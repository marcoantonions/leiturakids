<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <link rel="icon" type="image/png" href="img/ancora.png">
    <link rel="stylesheet" type="text/css" href="style_atividades.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="script_atividades.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <title>Atividades - Leitura Kids</title>
</head>

<body>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const SUPABASE_URL = 'https://dnphjoqmkvnjueiwjayu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRucGhqb3Fta3ZuanVlaXdqYXl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NjE3ODEsImV4cCI6MjA3MzUzNzc4MX0.r8-M9EZg73sIrwESfd61hyGITsEwv_TJFZOBYeXk3d8';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Exporta o supabase globalmente para uso no script_atividades.js
        window.supabaseClient = supabase;

        async function carregarPontuacaoGlobal() {
            console.log("Carregando pontua√ß√£o global...");

            const usuarioId = localStorage.getItem('usuarioId');
            console.log("ID do usu√°rio:", usuarioId);

            if (!usuarioId) {
                console.warn(" Nenhum usu√°rio logado");
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('progresso')
                    .select('pontos, atividades_concluidas, acertos')
                    .eq('user_id', usuarioId)
                    .maybeSingle();

                if (error) {
                    console.error(" Erro ao buscar pontua√ß√£o global:", error);
                    return;
                }

                console.log(" Dados recebidos:", data);

                if (data) {
                    // Atualiza os elementos da interface
                    document.getElementById('total-score').textContent = data.pontos ?? 0;
                    document.getElementById('total-correct').textContent = data.acertos ?? 0;
                    document.getElementById('act-completed').textContent = data.atividades_concluidas ?? 0;

                    // Salva no localStorage para sincroniza√ß√£o com o JS
                    const gameStats = {
                        totalScore: data.pontos ?? 0,
                        totalCorrect: data.acertos ?? 0,
                        gamesPlayed: data.atividades_concluidas ?? 0,
                    };
                    localStorage.setItem('gameStats', JSON.stringify(gameStats));
                    console.log(" Progresso sincronizado com localStorage");
                } else {
                    console.log("‚ÑπÔ∏è Nenhum progresso encontrado, usando valores padr√£o");
                }
            } catch (err) {
                console.error(" Erro inesperado:", err);
            }
        }

        // Carrega quando a p√°gina estiver pronta
        window.addEventListener('DOMContentLoaded', carregarPontuacaoGlobal);
    </script>

    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <a href="home.html" class="logo">LeituraKids</a>
            <nav>

                <div class="dropdown">
                    <button onclick="toggleMenu()" class="btn btn-gray">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <div id="menuDropdown" class="dropdown-content">
                        <a href="index.html#contact">Ajuda</a>
                        <a href="index.html">Sair</a>
                    </div>
                </div>
            </nav>
        </div>
        </div>
    </header>

    <!-- Menu Vertical -->
    <nav class="side-nav">
        <div class="side-nav-item" onclick="window.location.href='home.html'" title="Perfil">
            <img src="img/casa.png" alt="Perfil">
        </div>
        <div class="side-nav-item" onclick="window.location.href='aulas.html'" title="Aulas">
            <img src="img/livro.png" alt="Aulas">
        </div>
        <div class="side-nav-item active" onclick="window.location.href='atividades.html'" title="Atividades">
            <img src="img/lapis.png" alt="Atividades">
        </div>
        <div class="side-nav-item" onclick="window.location.href='mapa.html'" title="Mapa">
            <img src="img/mapa.png" alt="Mapa">
        </div>
        <div class="side-nav-item" onclick="window.location.href='jogos.html'" title="Jogos">
            <img src="img/controle.png" alt="Jogos">
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <main class="main-content">
        <div class="activities-container">
            <!-- Cabe√ßalho -->
            <div class="activities-header">
                <h1 class="activities-title">Central de Atividades</h1>
                <p class="activities-subtitle">Escolha uma atividade e pratique suas habilidades de leitura!</p>
            </div>

            <!-- Pontua√ß√£o Global -->
            <div class="global-score">
                <div class="score-item">
                    <img src="img/trofeu.png" alt="Trof√©u" class="icon">
                    <span id="total-score">0</span> pontos
                </div>
                <div class="score-item">
                    <img src="img/estrela.png" alt="Estrela" class="icon">
                    <span id="total-correct">0</span> acertos
                </div>
                <div class="score-item">
                    <img src="img/lapis.png" alt="L√°pis" class="icon">
                    <span id="act-completed">0</span> atividades
                </div>
                <div class="score-item">
                    <img src="img/fogo.png" alt="Fogo" class="icon">Sequ√™ncia: <span id="streak">0</span>
                </div>
            </div>


            <!-- Menu de Atividades -->
            <div class="activities-menu" id="activities-menu">
                <div class="activity-card" onclick="showGame('complete-word')">
                    <span class="activity-icon">
                        <img src="img/carangueijo.png" alt="Complete a Palavra">
                    </span>
                    <h3 class="activity-title">Complete a Palavra</h3>
                    <p class="activity-description">Clique nas letras corretas para formar a palavra. Use as dicas
                        visuais para descobrir qual palavra completar!</p>
                </div>

                <div class="activity-card" onclick="showGame('sentence-builder')">
                    <span class="activity-icon">
                        <img src="img/polvo.png" alt="Complete a Palavra">
                    </span>
                    <h3 class="activity-title">Forme a Frase</h3>
                    <p class="activity-description">Organize as palavras na ordem correta para criar frases que fazem
                        sentido. Teste sua compreens√£o gramatical!</p>
                </div>

                <div class="activity-card" onclick="showGame('sound-quiz')">
                    <span class="activity-icon">
                        <img src="img/cavalom.png" alt="Complete a Palavra">
                    </span>
                    <h3 class="activity-title">Quiz de Sons</h3>
                    <p class="activity-description">Ou√ßa a palavra falada e escolha a grafia correta entre as op√ß√µes.
                        Desenvolva sua percep√ß√£o auditiva!</p>
                </div>

                <div class="activity-card" onclick="showGame('rhyme-game')">
                    <span class="activity-icon1">
                        <img src="img/barao-rima.png" alt="Encontre a Rima">
                    </span>
                    <h3 class="activity-title">Encontre a Rima</h3>
                    <p class="activity-description">Identifique qual palavra rima com a palavra apresentada. Aprenda
                        sobre sonoridade e termina√ß√µes similares!</p>
                </div>

                <div class="activity-card" onclick="showGame('syllable-order')">
                    <span class="activity-icon0">
                        <img src="img/criancas.png" alt="Ordene as s√≠labas">
                    </span>
                    <h3 class="activity-title">Ordene as S√≠labas</h3>
                    <p class="activity-description">Clique nas s√≠labas na sequ√™ncia correta para formar palavras.
                        Pratique divis√£o sil√°bica de forma divertida!</p>
                </div>

                <div class="activity-card" onclick="showGame('letter-hunt')">
                    <span class="activity-icon0">
                        <img src="img/golfinho.png" alt="Complete a Palavra">
                    </span>
                    <h3 class="activity-title">Ca√ßa Letras</h3>
                    <p class="activity-description">Encontre rapidamente a letra solicitada entre todas as op√ß√µes.
                        Melhore sua velocidade de reconhecimento!</p>
                </div>
            </div>

            <!-- Jogo 1: Complete a Palavra -->
            <div class="game-container" id="complete-word">
                <div class="game-header">
                    <h2 class="game-title">‚úèÔ∏è Complete a Palavra</h2>
                    <button class="back-button" onclick="showMenu()">Voltar</button>
                </div>

                <div class="target-letter-display" id="word-hint">üè† CASA</div>
                <div class="word-puzzle" id="word-puzzle"></div>
                <div class="letter-options" id="letter-options"></div>

                <div class="action-buttons">
                    <button class="action-button" onclick="checkWord()">Verificar</button>
                    <button class="action-button" onclick="nextWord()">Pr√≥xima Palavra</button>
                </div>
                <div class="feedback" id="word-feedback"></div>
            </div>

            <!-- Jogo 2: Forme a Frase -->
            <div class="game-container" id="sentence-builder">
                <div class="game-header">
                    <h2 class="game-title">üìù Forme a Frase</h2>
                    <button class="back-button" onclick="showMenu()">Voltar</button>
                </div>

                <div class="sentence-target" id="sentence-target">Monte a frase: "O gato subiu na √°rvore"</div>
                <div class="sentence-drop-zone" id="sentence-drop-zone">
                    <span style="color: #7f8c8d;">Clique nas palavras abaixo na ordem correta</span>
                </div>
                <div class="letter-options" id="sentence-words"></div>

                <div class="action-buttons">
                    <button class="action-button" onclick="checkSentence()">Verificar Frase</button>
                    <button class="action-button" onclick="nextSentence()">Nova Frase</button>
                </div>
                <div class="feedback" id="sentence-feedback"></div>
            </div>

            <!-- Jogo 3: Quiz de Sons -->
            <div class="game-container" id="sound-quiz">
                <div class="game-header">
                    <h2 class="game-title">üîä Quiz de Sons</h2>
                    <button class="back-button" onclick="showMenu()">Voltar</button>
                </div>

                <div class="target-letter-display">Clique no bot√£o para ouvir a palavra:</div>
                <button class="sound-button" onclick="playCurrentWord()">üîä</button>
                <div class="quiz-options" id="quiz-options"></div>

                <div class="action-buttons">
                    <button class="action-button" onclick="nextSoundQuiz()">Pr√≥xima Palavra</button>
                </div>
                <div class="feedback" id="quiz-feedback"></div>
            </div>

            <!-- Jogo 4: Encontre a Rima -->
            <div class="game-container" id="rhyme-game">
                <div class="game-header">
                    <h2 class="game-title">üéµ Encontre a Rima</h2>
                    <button class="back-button" onclick="showMenu()">Voltar</button>
                </div>

                <div class="rhyme-word-display" id="rhyme-word-display">GATO</div>
                <div class="rhyme-options" id="rhyme-options"></div>

                <div class="action-buttons">
                    <button class="action-button" onclick="nextRhymeWord()">Pr√≥xima Palavra</button>
                </div>
                <div class="feedback" id="rhyme-feedback"></div>
            </div>

            <!-- Jogo 5: Ordene as S√≠labas -->
            <div class="game-container" id="syllable-order">
                <div class="game-header">
                    <h2 class="game-title">üîÄ Ordene as S√≠labas</h2>
                    <button class="back-button" onclick="showMenu()">Voltar</button>
                </div>

                <div class="target-letter-display" id="syllable-target">Forme a palavra: CASA</div>
                <div class="syllable-drop-zone" id="syllable-drop-zone">
                    <span style="color: #7f8c8d;">Clique nas s√≠labas na ordem correta</span>
                </div>
                <div class="letter-options" id="syllable-options"></div>

                <div class="action-buttons">
                    <button class="action-button" onclick="checkSyllableOrder()">Verificar</button>
                    <button class="action-button" onclick="nextSyllableWord()">Nova Palavra</button>
                </div>
                <div class="feedback" id="syllable-feedback"></div>
            </div>

            <!-- Jogo 6: Ca√ßa Letras -->
            <div class="game-container" id="letter-hunt">
                <div class="game-header">
                    <h2 class="game-title">üîç Ca√ßa Letras</h2>
                    <button class="back-button" onclick="showMenu()">Voltar</button>
                </div>

                <div class="target-letter-display" id="target-letter-display">Encontre a letra: A</div>
                <div class="alphabet-grid" id="alphabet-grid"></div>

                <div class="action-buttons">
                    <button class="action-button" onclick="nextLetterHunt()">Nova Letra</button>
                </div>
                <div class="feedback" id="letter-feedback"></div>
            </div>
        </div>
    </main>
    <a href="#" class="ancora">
        <span class="material-symbols-outlined">anchor</span>
    </a>
</body>

</html>